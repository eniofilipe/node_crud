extends template

block title
    title PDV

block content
    div.row
        div.card-group
            .card.mx-2.shadow.card-pdv    
                .card-header.bg-success 
                    i.fas.fa-cart-plus 
                    span    Nova Venda
                .card-body
                    .input-group.mb-2
                        .row
                            .col-12
                                span.h3.col-12(id='label-produto') Produto
                        .row
                            .col-md-6
                                
                                img(id='img-venda',style='width: 100px; heigth:100px; ', src="../images/upload_files/SISTEMAOITV-1RECEPTOR.jpg")
                            .col-md-6
                                   
                                    label.col-form-label.mx.pr(for='inputCodigo') Código
                                    input.form-control.mx-0(type='text', placeholder='Código', id='inputCodigo')
                        .row        
                            .col-md-12
                                .row.mb-2
                                    .col-md-6
                                        label.col-form-label(for='inputCodigo') Quantidade
                                        input.form-control(type='text', onkeyup='calculaQuantidade()', value='1,0', id='inputQuantidade')
                                    .col-md-6
                                        label.col-form-label(for='inputCodigo') Valor Unitário
                                        .input-group
                                            .input-group-prepend
                                                span.input-group-text R$
                                            input.form-control(type='text', placeholder='0,00', id='inputValorUnit')
                        .row        
                            .col-md-12
                                .row.mb-2
                                    .col-md-6
                                        label.col-form-label(for='inputCodigo') Desconto
                                        .input-group
                                            .input-group-prepend
                                                span.input-group-text R$
                                            input.form-control(type='text', onkeyup='calculaDesconto()', value='0,00', id='inputDesconto')
                                    .col-md-6
                                        label.col-form-label(for='inputCodigo') Valor Total
                                        .input-group
                                            .input-group-prepend
                                                span.input-group-text R$    
                                            input.form-control.bg-dark.text-white(type='text',  placeholder='0,00',id='inputValorTotal')
                .card-footer.p-0
                        button.btn.btn-success.btn-lg.btn-block.rounded-0(id='buttonAdicionar') Adicionar produto
            .card.mx-0.shadow.card-pdv    
                .card-header.bg-warning  
                    i.fas.fa-cart-plus 
                    span    Produtos
                .card-body
                    .input-group.mb-2
                        input.form-control.mx-0(type='text', placeholder="Código", onkeyup='buscaProdutosCodigo(1)',id='inputBuscarProdutosCodigo' )
                    .input-group.mb-4
                        input.form-control.mx-0(type='text', placeholder="Produto", onkeyup='buscaProdutos(1)',id='inputBuscarProdutos' )
                    .container-fluid(id='listaProdutos')
                        .row.align-middle
                            case produtos
                                when 0
                                    p.text-center Não achamos ninguém
                                default
                                    each produtos in tabela
                                        .btn.card.col-4.text-center.btn-outline-dark.cardProduto.m-0.p-0(name='cardProduto', id=produtos.id , data-detalhes='{"id":"'+produtos.id+'", "nome":"'+produtos.nome+'", "preco":"'+produtos.preco+'", "imagem":"'+produtos.imagem+'" }' )
                                            .card-body.p-1
                                                img.brand-card-img-top(src="../images/upload_files/"+produtos.imagem,style='width: 70px; heigth:70px;')
                                            .card-footer.p-1
                                                a.h6 #{produtos.nome}
                                            
                                                
                
                .card-footer.p-0.m-0    
                    nav.m-0
                        ul.pagination.justify-content-center(id='paginacao').m-0
                
                script. 
                    $(document).ready(function(){
                        

                        $('#buttonAdicionar').click(function(){
                            var nome, qtd, val, itemTabela;
                            nome = $("#label-produto").text();
                            qtd = $("#inputQuantidade").val();
                            val = $("#inputValorTotal").val();

                            itemTabela = '<tr><td>'+nome+'</td><td>'+qtd+'</td><td>'+val+'</td></tr>';

                            $('#tabelaVenda').append(itemTabela);

                        })

                        $('.btn.cardProduto').click(function(){
                            var aux = $(this).data("detalhes");
                            
                            
                            $("#img-venda").attr('src',"../images/upload_files/"+aux.imagem);
                            $("#img-venda").hide();
                            $("#img-venda").fadeIn(500);

                            $("#label-produto").html(aux.nome) ;
                            $("#inputCodigo").attr('value',aux.id) ;
                            $("#inputValorUnit").attr('value',aux.preco);
                            $("#inputQuantidade").attr('value',1.0);
                            $("#inputValorTotal").attr('value',aux.preco);

                        });
                        
                        buscaProdutos(1);
                    });

                    function calculaQuantidade(){
                        var desc = parseFloat(($("#inputDesconto").val()).replace(',','.'));
                        var quant = parseFloat(($("#inputQuantidade").val()).replace(',','.'));

                        var unit = $("#inputValorUnit").val();
                        var val = unit*quant - desc;

                        $("#inputValorTotal").attr('value',val.toString().replace('.',','));
                    }

                    function calculaDesconto(){
                        var desc = parseFloat(($("#inputDesconto").val()).replace(',','.'));
                        var quant = parseFloat(($("#inputQuantidade").val()).replace(',','.'));

                        var unit = $("#inputValorUnit").val();
                        var val = unit*quant - desc;

                        $("#inputValorTotal").attr('value',val.toString().replace('.',','));
                    }

                    function passaDados(aux){
                            var opa = aux[0].text();
                            alert(opa);
                    }                    

                    function ajustaBotoes(){

                        
                        var i,  listaProdutos,ul, carP, funcao;
                        var navegacao='';
                        var cont;
                        listaProdutos = document.getElementById("listaProdutos");
                        
                        cardP = listaProdutos.getElementsByClassName("card");


                        cont=0;
                            
                        
                        
                        cont = Math.ceil(cardP.length/9);

                        for(i=0; i < cont; i++){
                            //$('#paginacao').append($('<li class="page-item">').append($('<a class="page-link" href="#">').append(i+1)));
                            funcao = "javascript:buscaProdutos("+(i+1)+")";
                            navegacao+='<li class="page-item"><a class="page-link" href=javascript:buscaProdutos('+(i+1)+')>'+(i+1)+'</a></li>';
                        }   
                        $('#paginacao').html(navegacao);
                    }   

                    function buscaProdutos(pagina) {
                        
                        var input, filter, cardP, listaProdutos, a, i , txtValue;
                        
                        input = document.getElementById('inputBuscarProdutos');
                        
                        filter = input.value.toUpperCase();
                        
                        listaProdutos = document.getElementById("listaProdutos");
                        
                        cardP = listaProdutos.getElementsByClassName("card");
                        
                        var aux = ((pagina-1)*9)-1;

                       
                        for(i=0;i<cardP.length;i++){
                                    
                            cardP[i].style.display = "none";
                                    
                        }
                        i=0;
                        while( i < cardP.length ){
                            

                            if(i > aux){
                                if( i < ( pagina * 9 ) ){
                                    a = cardP[i].getElementsByTagName("a")[0];
                                    txtValue = a.textContent || a.innerText;
                                    
                                    if(txtValue.toUpperCase().indexOf(filter) > -1){
                                        cardP[i].style.display = "";
                                    } else {
                                        cardP[i].style.display = "none";
                                    }
                                }
                            }

                            

                            i++;
                        }


                        

                        ajustaBotoes();
                    }

                    function buscaProdutosCodigo(pagina) {
                        
                        var input, filter, cardP, listaProdutos, a, i , txtValue;
                        
                        input = document.getElementById('inputBuscarProdutosCodigo');
                        
                        filter = input.value;
                        
                        

                        listaProdutos = document.getElementById("listaProdutos");
                        
                        cardP = listaProdutos.getElementsByClassName("card");
                        
                        var aux = ((pagina-1)*9)-1;

                       
                        for(i=0;i<cardP.length;i++){
                                    
                            cardP[i].style.display = "none";
                                    
                        }
                        i=0;
                        while( i < cardP.length ){
                            

                            if(i > aux){
                                if( i < ( pagina * 9 ) ){
                                    
                                    a = cardP[i].id;
                                    
                                    if(filter == ""){
                                        cardP[i].style.display = "";    
                                    }else if(a == filter){
                                        cardP[i].style.display = "";
                                    } else {
                                        cardP[i].style.display = "none";
                                    }
                                }
                            }

                            

                            i++;
                        }


                        

                        ajustaBotoes();
                    }

            .card.mx-2.shadow.card-pdv   
                .card-header.bg-danger  
                    i.fas.fa-cart-plus 
                    span    Nota       
                .card-body
                    .input-group.mb-2   
                        input.form-control(type='text', placeholder="Cliente", aria-describedby='button-addon1' )
                        div.input-group-append(id='button-addon1')
                            button.btn.btn-outline-secondary(type='button')
                                i.fas.fa-search
                            button.btn.btn-outline-secondary(type='button')
                                i.fas.fa-plus
                    .row.border.p-0
                        table.table.table-striped.table-sm.border-left.border-right.m-0
                            thead
                                    tr
                                        th(scope="col") Produto
                                        th(scope="col") Qtd
                                        th(scope="col") Val. Tt.
                        .table-responsive(style="overflow: auto; height: 350px;")
                            table.table.table-striped.table-sm.border-left.border-right
                                tbody(id='tabelaVenda' )
                .card-footer.p-0
                    .row
                        .col-6
                            span.h4 Total: 
                        .col-6.bg-dark
                            span.h4.text-light R$ 150,00
                    .row.p-0
                        .col-12
                            button.btn.btn-danger.btn-block.rounded-0(id='buttonFinalizar') Finalizar Venda
